version: '3'

services:
  salzweb:
    build:
      context: ../.
      dockerfile: build/salzweb/Dockerfile
    command: salzweb
    environment:
      - ADDR=0.0.0.0:80
      - DB_CONFIG=host=postgres port=5432 user=postgres password=postgres sslmode=disable dbname=game
    depends_on:
      - postgres
    ports:
      - "3000:80"

  salza:
    build:
      context: ../.
      dockerfile: build/salza/Dockerfile
    command: salza
    environment:
      - ADDR=0.0.0.0:3000
    depends_on:
      - postgres

  redis:
    container_name: redis
    image: redis
    ports:
      - 6379:6379

  postgres:
    image: postgres:9.6
    ports:
      - 5432
    environment:
      - POSTGRES_DB=game
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=postgres
      - TZ=GMT

  pgadmin:
    image: dpage/pgadmin4
    environment:
      PGADMIN_DEFAULT_EMAIL: "admin@admin.onion"
      PGADMIN_DEFAULT_PASSWORD: "nopasswd"
    ports:
      - "16543:80"

  grafana:
    image: grafana/grafana
    container_name: grafana
    ports:
      - 5050:3000
    volumes:
      - grafana-volume

  graphite:
    image: graphiteapp/graphite-statsd
    container_name: graphite
    ports:
      - 2003:2003
    restart: always

volumes:
  grafana-volume:
    external: true
